<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="../../css/styles.css">
    <link rel="stylesheet" href="../../css/studyhelp.css"> <!-- Create a CSS file for your study help page styles -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">

    <title>Study Help</title>
    <link rel="icon" type="image/x-icon" href="../favicon.png">
</head>
<body>
    
        <nav class="nav container">
            <a href="../index.html" class="logo">
                <i class="ri-school-line"></i> Study Sphere
            </a>
            <div class="nav_bar" id="nav-menu">
                <ul class="nav_content_list">
                    <li class="nav_item">
                        <a href="./home.html" class="nav_button_normal">Home</a>
                    </li>
                    <li class="nav_item">
                        <a href="./resources.html" class="nav_button_normal">Resources and Materials</a>
                    </li>
                    <li class="nav_item">
                        <a href="./studyhelp.html" class="nav_button_normal">Study Help</a>
                    </li>
                </ul>
                <a href="../Auth/login.html" class="nav_button">Login</a>
            </div>
        </nav>

        <main class="main">
            <section class="study-help" >
                <div class="home_images">
                    <img src="../../images/points-space.svg" alt="image" class="home_points">
                    <img src="../../images/planet.svg" alt="image" class="home_planet-2">
                    <img src="../../images/planet.svg" alt="image" class="home_planet-1">
                </div>
                <div class="title_rocket">
                    <h2 id="trending_heading">Trending Advice for IMY 320</h2>
                    <img src="../../images/rocket.svg" alt="image" class="home_rocket">
                </div>
                <div class="comments-list" id="modulesContainer">
                    <!-- Comments will be dynamically added here -->
                </div>
            </section>
        </main>

    <script>
        // JavaScript for interacting with comments
        function getQueryParam(parameterName) {
            const queryString = window.location.search;
            const urlParams = new URLSearchParams(queryString);
            return urlParams.get(parameterName);
        }

        // Usage: Get the course name from the URL
        const courseName = getQueryParam("course");

        const trendingHeading = document.getElementById("trending_heading");
        trendingHeading.innerHTML = "Trending advice for " + courseName.split("-")[0];

        // Initialize userActions from local storage or an empty object
        const userActions = localStorage.getItem('userActions') ? JSON.parse(localStorage.getItem('userActions')) : {};

        // Dummy data for comments (replace with your own logic to fetch comments from a server)
        const commentsData = [
            { text: "This is a great study resource!", upvotes: 5, downvotes: 2, title: "Title 1" },
            { text: "I found the materials very helpful.", upvotes: 3, downvotes: 1, title: "Title 2" },
            { text: "This is a great study resource!", upvotes: 5, downvotes: 2, title: "Title 3" },
            { text: "I found the materials very helpful.", upvotes: 3, downvotes: 1, title: "Title 4" },
            { text: "This is a great study resource!", upvotes: 5, downvotes: 2, title: "Title 5" },
            { text: "I found the materials very helpful.", upvotes: 3, downvotes: 1, title: "Title 6" },
            { text: "This is a great study resource!", upvotes: 5, downvotes: 2, title: "Title 7" },
            { text: "I found the materials very helpful.", upvotes: 3, downvotes: 1, title: "Title 8" },
        ];

        function renderComments() {
            const commentsList = document.querySelector(".comments-list");
            commentsList.innerHTML = ""; // Clear the existing comments

            // Sort comments by upvotes in descending order
            const sortedComments = commentsData.slice().sort((a, b) => b.upvotes - a.upvotes);

            sortedComments.forEach((comment, index) => {
                const commentElement = document.createElement("div");
                commentElement.classList.add("comment");

                const userAction = userActions[comment.title];

                commentElement.innerHTML = `
                    <div class="comment-card">
                        <div class="comment-title">${comment.title}</div>
                        <div class="comment-text">${comment.text}</div>
                    </div>
                    <div class="comment-votes">
                        <span class="upvote" onclick="toggleVote('${comment.title}', 'upvote')"><i class="fas fa-arrow-up"> Upvote</i> (${comment.upvotes})</span>
                        <br />
                        <br />
                        <span class="downvote" onclick="toggleVote('${comment.title}', 'downvote')"><i class="fas fa-arrow-down"> Downvote</i> (${comment.downvotes})</span>
                    </div>
                `;

                commentsList.appendChild(commentElement);
            });
        }

        function toggleVote(commentTitle, voteType) {
            const comment = commentsData.find(comment => comment.title === commentTitle);
            const userAction = userActions[comment.title];

            if (comment) {
                if (userAction !== voteType) {
                    // If the user hasn't voted or voted in the opposite direction, toggle the vote
                    if (voteType === 'upvote') {
                        comment.upvotes++;
                        if (userAction === 'downvote') comment.downvotes--;
                    } else if (voteType === 'downvote') {
                        comment.downvotes++;
                        if (userAction === 'upvote') comment.upvotes--;
                    }
                    userActions[commentTitle] = voteType; // Set the user action to the new vote
                } else {
                    // If the user already voted in the same direction, remove the vote
                    if (voteType === 'upvote') {
                        comment.upvotes--;
                    } else if (voteType === 'downvote') {
                        comment.downvotes--;
                    }
                    userActions[commentTitle] = ''; // Set the user action to neutral
                }

                localStorage.setItem('userActions', JSON.stringify(userActions)); // Update local storage
                renderComments();
            }
        }

        document.addEventListener("DOMContentLoaded", () => {
            renderComments();
        });
    </script>

    <div id="commentModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2>Add your advice</h2>
            <form id="comment-form" class="comment-form">
                <div>
                    <div>Title: </div>
                    <input type="text" id="comment-title" placeholder="Example Title" required>
                </div>
                <div>Advice: </div>
                <textarea id="comment-text" placeholder="Write your advice here..." required></textarea>
                <button id="submit-comment" type="submit" style="color:white;">Post Advice</button>
            </form>
        </div>
    </div>

    <div class="add-comment-button">
        <i class="fas fa-plus"></i>
    </div>

    <img src="../../images/clouds-1.svg" alt="image" class="home_cloud-1">
    <img src="../../images/clouds-2.svg" alt="image" class="home_cloud-2">
</body>
</html>
